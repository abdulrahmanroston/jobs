<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Applications Manager - Tender Fine Dining</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f1eb 0%, #e8ddd4 100%);
            color: #5d4e37;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(139, 115, 85, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(139, 115, 85, 0.2);
        }

        .header h1 {
            color: #8b7355;
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .header p {
            color: #a0956b;
            font-size: 1.1rem;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.8);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(139, 115, 85, 0.2);
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 115, 85, 0.15);
        }

        .stat-card h3 {
            color: #8b7355;
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .stat-card p {
            color: #a0956b;
            font-weight: 500;
        }

        .tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
            justify-content: center;
        }

        .tab {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.7);
            border: 2px solid rgba(139, 115, 85, 0.3);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #8b7355;
            font-weight: 500;
        }

        .tab:hover {
            background: rgba(139, 115, 85, 0.1);
            border-color: #8b7355;
        }

        .tab.active {
            background: #8b7355;
            color: white;
            border-color: #8b7355;
        }

        .search-container {
            margin-bottom: 30px;
            text-align: center;
        }

        .search-input {
            width: 100%;
            max-width: 500px;
            padding: 15px 20px;
            border: 2px solid rgba(139, 115, 85, 0.3);
            border-radius: 25px;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.9);
            color: #5d4e37;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #8b7355;
            box-shadow: 0 0 0 3px rgba(139, 115, 85, 0.1);
        }

        .search-input::placeholder {
            color: #a0956b;
        }

        .applications-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .application-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 24px;
            border: 2px solid rgba(139, 115, 85, 0.15);
            transition: all 0.3s ease;
            cursor: pointer;
            backdrop-filter: blur(8px);
            box-shadow: 0 4px 20px rgba(139, 115, 85, 0.08);
        }

        .application-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(139, 115, 85, 0.15);
            border-color: #8b7355;
        }

        .application-card.expanded {
            background: rgba(139, 115, 85, 0.03);
            border-color: #8b7355;
            box-shadow: 0 8px 30px rgba(139, 115, 85, 0.12);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(139, 115, 85, 0.1);
        }

        /* Enhanced applicant name styling for better readability */
        .applicant-name {
            color: #5d4e37;
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 6px;
            letter-spacing: -0.02em;
        }

        .applicant-email {
            color: #8b7355;
            font-size: 0.95rem;
            font-weight: 500;
        }

        .card-header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Improved status badge design */
        .status-badge {
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .status-not-open { background: linear-gradient(135deg, #f3e5ab, #e6d89a); color: #6b5b00; }
        .status-rejected { background: linear-gradient(135deg, #ffcdd2, #ffb3ba); color: #c62828; }
        .status-approved { background: linear-gradient(135deg, #c8e6c9, #a5d6a7); color: #2e7d32; }
        .status-special { background: linear-gradient(135deg, #e1bee7, #ce93d8); color: #7b1fa2; }
        .status-opened { background: linear-gradient(135deg, #bbdefb, #90caf9); color: #1565c0; }

        .expand-icon {
            color: #8b7355;
            font-size: 1.1rem;
            transition: transform 0.3s ease;
        }

        /* Enhanced info item styling for better hierarchy */
        .info-item {
            display: flex;
            margin-bottom: 16px;
            padding: 12px 0;
            border-bottom: 1px solid rgba(139, 115, 85, 0.08);
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: 700;
            color: #5d4e37;
            min-width: 140px;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-right: 16px;
        }

        .info-value {
            color: #6d5a47;
            line-height: 1.6;
            flex: 1;
            font-size: 0.95rem;
        }

        /* Enhanced portfolio link styling */
        .portfolio-link {
            color: #8b7355;
            text-decoration: none;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            background: rgba(139, 115, 85, 0.1);
            transition: all 0.3s ease;
        }

        .portfolio-link:hover {
            background: #8b7355;
            color: white;
            transform: translateY(-1px);
        }

        /* Improved action buttons with better spacing and hover effects */
        .card-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
            padding-top: 20px;
            border-top: 2px solid rgba(139, 115, 85, 0.1);
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 3px 12px rgba(0,0,0,0.1);
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .btn-not-open {
            background: linear-gradient(135deg, #f3e5ab, #e6d89a);
            color: #6b5b00;
        }

        .btn-rejected {
            background: linear-gradient(135deg, #ffcdd2, #ffb3ba);
            color: #c62828;
        }

        .btn-approved {
            background: linear-gradient(135deg, #c8e6c9, #a5d6a7);
            color: #2e7d32;
        }

        .btn-special {
            background: linear-gradient(135deg, #e1bee7, #ce93d8);
            color: #7b1fa2;
        }

        .btn-whatsapp {
            background: linear-gradient(135deg, #25d366, #128c7e);
            color: white;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #8b7355;
        }

        .loading i {
            font-size: 3rem;
            margin-bottom: 20px;
            animation: spin 2s linear infinite;
        }

        .load-more {
            text-align: center;
            margin: 30px 0;
        }

        .load-more-btn {
            background: #8b7355;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .load-more-btn:hover {
            background: #6d5a47;
            transform: translateY(-2px);
        }

        .load-more-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        /* Added missing modal CSS styles for portfolio popup */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 0;
            border: none;
            width: 90%;
            max-width: 1200px;
            height: 80%;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            background: #8b7355;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 18px;
        }

        .close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }

        .close:hover {
            opacity: 0.7;
        }

        .modal-iframe {
            width: 100%;
            height: calc(100% - 60px);
            border: none;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .applications-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .tabs {
                justify-content: flex-start;
                overflow-x: auto;
                padding-bottom: 10px;
            }

            .tab {
                flex-shrink: 0;
                padding: 10px 20px;
            }

            .card-actions {
                flex-direction: column;
            }

            .btn {
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 1.8rem;
            }

            .application-card {
                padding: 20px;
            }

            .stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
        }

        @media (min-width: 769px) {
            .applications-grid {
                grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
                gap: 25px;
            }
            
            .container {
                max-width: 1400px;
                margin: 0 auto;
            }
            
            .card-actions {
                flex-direction: row;
                justify-content: flex-start;
            }
        }

        @media (min-width: 1200px) {
            .applications-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #7983ff;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-users"></i> Job Applications Manager</h1>
            <p>Tender Fine Dining - Recruitment Dashboard</p>
        </div>

        <div class="stats" id="stats">
            <div class="stat-card">
                <div class="stat-number" id="totalCount">0</div>
                <div class="stat-label">Total Applications</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="notOpenCount">0</div>
                <div class="stat-label">Not Open</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="openedCount">0</div>
                <div class="stat-label">Opened</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="rejectedCount">0</div>
                <div class="stat-label">Rejected</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="approvedCount">0</div>
                <div class="stat-label">Approved</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="specialCount">0</div>
                <div class="stat-label">Special</div>
            </div>
        </div>

        <div class="search-container">
            <input type="text" class="search-input" id="searchInput" placeholder="Search by name, email, phone, or any field...">
        </div>

        <div class="tabs">
            <button class="tab active" data-status="not-open">
                <i class="fas fa-envelope"></i> Not Open
            </button>
            <button class="tab" data-status="opened">
                <i class="fas fa-envelope-open"></i> Opened
            </button>
            <button class="tab" data-status="rejected">
                <i class="fas fa-times-circle"></i> Rejected
            </button>
            <button class="tab" data-status="approved">
                <i class="fas fa-check-circle"></i> Approved
            </button>
            <button class="tab" data-status="special">
                <i class="fas fa-star"></i> Special
            </button>
            <button class="tab" data-status="all">
                <i class="fas fa-list"></i> All Applications
            </button>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            Loading applications...
        </div>

        <div class="applications-grid" id="applicationsGrid"></div>
    </div>

    <div id="portfolioModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Portfolio/Website</h2>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <iframe id="modalIframe" class="modal-iframe"></iframe>
        </div>
    </div>

    <script>
        // Configuration
        const GOOGLE_SHEETS_API_KEY = 'AIzaSyC8NMuqnfi5oUE3-6rdULhbWHf5nRNyc_Y';
        const SPREADSHEET_ID = '10bidT0idDqTw7qXVIWVLXtjK9Cq2Cw3OzRgH2KSRmKg';

        // Global variables
        let applications = [];
        let filteredApplications = [];
        let currentTab = 'not-open';
        let searchTerm = '';
        let applicationStatus = {};
        let openedCards = new Set();
        
        let currentPage = 0;
        const ITEMS_PER_PAGE = 50;
        let allApplicationsLoaded = false;
        let isLoading = false;

        // WhatsApp message template
        const WHATSAPP_MESSAGE = `Good morning,

We have reviewed your work and found it impressive.

The number of applicants is very large, so after filtering and to ensure the opportunity reaches those who deserve it, we have selected a small number to whom we will send our social media links and website, as well as a group of links to other pages whose work we find appealing.

We have chosen you in the first stage from the people we see as suitable üôè‚ù§Ô∏è

We ask you to look at our social media and website carefully and understand what we offer and how our visual identity works, and you will find at the end of the message below a simple description explaining who we are.

After that, create a design with an idea of your choice that you think is suitable for our identity and of course in English.

We will give you 48 hours to choose the times when you are free at your convenience to look at our social media carefully so that you can create something that expresses your work first and secondly your understanding of the nature of our identity.

After that, you will send it on WhatsApp here and we will review all the designs sent and choose the best design, and within 42 hours we will inform the owner of the best design.

This design will not be published or used in any work. It is just to know the best person who understood the company's identity and whose taste is suitable for us.

It is important that you add a line across the design at the top with a length of 5% to 7% of the design length or an appropriate size with the WhatsApp number and the name you sent in the form written on it so that the designs do not get mixed up.

Please, if the work is important to you and you take it seriously and are sure that you will commit to the work if we choose you, continue the procedures. If you filled out the form just out of curiosity, we ask you to leave the opportunity for someone who needs the work and is ready to provide the best üôè

*About the company:*
*We are a company called Tender fine dining. We sell Frozen food and do Catering, and we have T wok where we sell Chinese food. The most important thing for us and what will be required to work on and focus on especially will be the Frozen food, and you will find our website has all the products related to it, and you will find on social media the previous designs related to it as well*

Website: https://tenderfrozen.com
Facebook: https://www.facebook.com/share/1PAMWkrFNc/
Instagram: https://www.instagram.com/tender.dining?igsh=ZmJodTZlZWJ5ZWJp

Pages we want you to look at the designs they post, and these are just to get an idea, but you should also be creative:
https://www.instagram.com/instachef.me?igsh=c3gyanM5cXV4N2Ry
https://www.instagram.com/fambeef.egypt?igsh=MXhxMjQ0eXM0NHhsdw==
https://www.facebook.com/share/1CKQ1BEjLY/`;

        const POSSIBLE_RANGES = [
            'Sheet1!A1:AD1000',
            'Sheet1!A:AD',
            'Sheet1!A1:AD',
            'A1:AD1000',
            'A:AD',
            'A1:AD',
            'Sheet1'
        ];

        async function tryDifferentRanges() {
            console.log("[v0] Trying different range formats...");
            
            for (let i = 0; i < POSSIBLE_RANGES.length; i++) {
                const range = POSSIBLE_RANGES[i];
                console.log(`[v0] Trying range ${i + 1}/${POSSIBLE_RANGES.length}: ${range}`);
                
                try {
                    const encodedRange = encodeURIComponent(range);
                    const apiUrl = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${encodedRange}?key=${GOOGLE_SHEETS_API_KEY}`;
                    console.log("[v0] Testing API URL:", apiUrl);
                    
                    const response = await fetch(apiUrl);
                    console.log(`[v0] Range ${range} - Status:`, response.status);
                    
                    if (response.ok) {
                        const data = await response.json();
                        if (data.values && data.values.length > 0) {
                            console.log(`[v0] SUCCESS! Range ${range} works with ${data.values.length} rows`);
                            return { range, data };
                        }
                    } else {
                        const errorText = await response.text();
                        console.log(`[v0] Range ${range} failed:`, errorText);
                    }
                } catch (error) {
                    console.log(`[v0] Range ${range} error:`, error.message);
                }
                
                // Small delay between attempts
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            throw new Error("All range formats failed");
        }

        async function loadApplications() {
            console.log("[v0] Starting to load applications...");
            console.log("[v0] API Key:", GOOGLE_SHEETS_API_KEY ? "Present" : "Missing");
            console.log("[v0] Spreadsheet ID:", SPREADSHEET_ID);
            
            try {
                const result = await tryDifferentRanges();
                const data = result.data;
                const workingRange = result.range;
                
                console.log("[v0] Using working range:", workingRange);
                console.log("[v0] Response data:", data);
                
                if (data.values && data.values.length > 1) {
                    console.log("[v0] Found", data.values.length, "rows of data");
                    const headers = data.values[0];
                    console.log("[v0] Headers:", headers);
                    console.log("[v0] Number of columns:", headers.length);
                    
                    applications = data.values.slice(1).map((row, index) => {
                        const app = {};
                        headers.forEach((header, i) => {
                            app[header] = row[i] || '';
                        });
                        app.id = index;
                        app.code = app['Timestamp'] || app['ÿ∑ÿßÿ®ÿπ ÿ≤ŸÖŸÜŸä'] || `app_${index}`;
                        return app;
                    });
                    
                    console.log("[v0] Processed", applications.length, "applications");
                    console.log("[v0] Sample application:", applications[0]);
                    
                    loadStatusFromStorage();
                    updateStats();
                    filterApplications();
                    
                    currentPage = 0;
                    allApplicationsLoaded = false;
                    renderApplicationsPaginated();
                    
                    window.addEventListener('scroll', handleScroll);
                    
                } else {
                    console.log("[v0] No data found in spreadsheet");
                    showError("No data found in the spreadsheet. Please check if the spreadsheet contains data.");
                }
            } catch (error) {
                console.log("[v0] Error loading applications:", error.message);
                showError("Failed to load applications: " + error.message);
            }
        }

        function handleScroll() {
            if (isLoading || allApplicationsLoaded) return;
            
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            const windowHeight = window.innerHeight;
            const documentHeight = document.documentElement.scrollHeight;
            
            // Load more when user is 200px from bottom
            if (scrollTop + windowHeight >= documentHeight - 200) {
                loadMoreApplications();
            }
        }

        function loadMoreApplications() {
            if (isLoading || allApplicationsLoaded) return;
            
            isLoading = true;
            const loadingIndicator = document.getElementById('loadingMore');
            if (loadingIndicator) {
                loadingIndicator.style.display = 'block';
            }
            
            // Simulate loading delay for better UX
            setTimeout(() => {
                currentPage++;
                renderApplicationsPaginated();
                isLoading = false;
                if (loadingIndicator) {
                    loadingIndicator.style.display = 'none';
                }
            }, 300);
        }

        function loadSampleData() {
            console.log("[v0] Loading sample data for testing...");
            
            applications = [
                {
                    id: 0,
                    code: 'sample_001',
                    'Full Name': 'Ahmed Mohamed Ali',
                    'Email': 'ahmed.mohamed@email.com',
                    'WhatsApp number': '+201234567890',
                    'Phone': '+201234567890',
                    'Age': '25',
                    'Country': 'Egypt',
                    'Years of experience': '3',
                    'Portfolio / Website': 'https://ahmed-portfolio.com',
                    status: 'not open'
                },
                {
                    id: 1,
                    code: 'sample_002',
                    'Full Name': 'Fatma Ahmed Hassan',
                    'Email': 'fatma.ahmed@email.com',
                    'WhatsApp number': '+201987654321',
                    'Phone': '+201987654321',
                    'Age': '28',
                    'Country': 'Egypt',
                    'Years of experience': '5',
                    'Portfolio / Website': 'https://fatma-designs.com',
                    status: 'approved'
                },
                {
                    id: 2,
                    code: 'sample_003',
                    'Full Name': 'Mohamed Abdullah Salem',
                    'Email': 'mohamed.abdullah@email.com',
                    'WhatsApp number': '+201555666777',
                    'Phone': '+201555666777',
                    'Age': '30',
                    'Country': 'Saudi Arabia',
                    'Years of experience': '7',
                    'Portfolio / Website': 'https://mohamed-creative.com',
                    status: 'special'
                }
            ];
            
            console.log("[v0] Sample data loaded:", applications.length, "applications");
            
            updateStats();
            filterApplications();
            
            // Show success message
            document.getElementById('loading').innerHTML = `
                <div style="text-align: center; color: #28a745; margin-bottom: 20px;">
                    <i class="fas fa-check-circle" style="font-size: 2rem; margin-bottom: 10px;"></i>
                    <h4>‚úÖ Sample Data Loaded Successfully!</h4>
                    <p style="font-size: 0.9rem; opacity: 0.8;">You can now test the application features. Replace with real Google Sheets data when API is configured.</p>
                </div>
            `;
            
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
            }, 2000);
        }

        function loadStatusFromStorage() {
            console.log("[v0] Loading status from localStorage...");
            const savedStatuses = JSON.parse(localStorage.getItem('applicationStatuses') || '{}');
            console.log("[v0] Saved statuses:", savedStatuses);
            
            applications.forEach(app => {
                app.status = savedStatuses[app.code] || 'not open';
            });
            
            console.log("[v0] Status loaded for", applications.length, "applications");
        }

        function saveStatusToStorage(code, status) {
            console.log("[v0] Saving status:", code, "->", status);
            const savedStatuses = JSON.parse(localStorage.getItem('applicationStatuses') || '{}');
            savedStatuses[code] = status;
            localStorage.setItem('applicationStatuses', JSON.stringify(savedStatuses));
            console.log("[v0] Status saved successfully");
        }

        function updateStats() {
            console.log("[v0] Updating statistics...");
            const stats = {
                total: applications.length,
                'not open': 0,
                'opened': 0,
                'rejected': 0,
                'approved': 0,
                'special': 0
            };

            applications.forEach(app => {
                stats[app.status]++;
            });

            console.log("[v0] Statistics:", stats);

            document.getElementById('totalCount').textContent = stats.total;
            document.getElementById('notOpenCount').textContent = stats['not open'];
            document.getElementById('openedCount').textContent = stats.opened;
            document.getElementById('rejectedCount').textContent = stats.rejected;
            document.getElementById('approvedCount').textContent = stats.approved;
            document.getElementById('specialCount').textContent = stats.special;
        }

        function renderApplicationsPaginated() {
            console.log("[v0] Rendering paginated applications, page:", currentPage);
            const grid = document.getElementById('applicationsGrid');
            const loading = document.getElementById('loading');
            
            if (currentPage === 0) {
                loading.style.display = 'none';
                grid.innerHTML = '';
            }

            if (filteredApplications.length === 0 && currentPage === 0) {
                console.log("[v0] No applications to display");
                grid.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-search"></i>
                        <h3>No applications found</h3>
                        <p>Try adjusting your search or filter criteria</p>
                    </div>
                `;
                return;
            }

            const startIndex = currentPage * ITEMS_PER_PAGE;
            const endIndex = Math.min(startIndex + ITEMS_PER_PAGE, filteredApplications.length);
            const pageApplications = filteredApplications.slice(startIndex, endIndex);
            
            if (pageApplications.length === 0) {
                allApplicationsLoaded = true;
                return;
            }

            const pageHTML = pageApplications.map(app => `
                <div class="application-card" onclick="toggleCard(this, '${app.code}')">
                    <div class="card-header">
                        <div>
                            <div class="applicant-name">${formatValue(app['Full Name'])}</div>
                            <div class="applicant-email">${formatValue(app['Email'])}</div>
                        </div>
                        <div class="card-header-right">
                            <div class="status-badge status-${app.status.replace(' ', '-')}">${app.status}</div>
                            <i class="fas fa-chevron-down expand-icon"></i>
                        </div>
                    </div>
                    
                    <div class="card-info" style="display: none;">
                        <div class="info-item">
                            <div class="info-label">WhatsApp</div>
                            <div class="info-value">${formatValue(app['WhatsApp number'])}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Phone</div>
                            <div class="info-value">${formatValue(app['Phone'])}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Gender</div>
                            <div class="info-value">${formatValue(app['Gender'])}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Marital Status</div>
                            <div class="info-value">${formatValue(app['marital status'])}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Age</div>
                            <div class="info-value">${formatValue(app['Age'])}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Country</div>
                            <div class="info-value">${formatValue(app['Country'])}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Address</div>
                            <div class="info-value">${formatValue(app['Address'])}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">About</div>
                            <div class="info-value">${formatValue(app['About your Self'])}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Experience</div>
                            <div class="info-value">${formatValue(app['Years of experience'])}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Portfolio</div>
                            <div class="info-value">
                                ${app['Portfolio / Website'] ? 
                                    `<a href="#" onclick="event.stopPropagation(); openPortfolio('${app['Portfolio / Website']}', '${app['Full Name']}'); return false;" class="portfolio-link">
                                        <i class="fas fa-external-link-alt"></i> View Portfolio
                                    </a>` : 
                                    'Not provided'
                                }
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Design Links</div>
                            <div class="info-value">${formatValue(app['Share links to your top 5 designs that you think are close to our company\'s visual identity. (Put each link on one line.)'])}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Video Design Background</div>
                            <div class="info-value">${formatValue(app['Do you have a background in short video design?'])}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Food Industry Experience</div>
                            <div class="info-value">${formatValue(app['Have you ever worked in the food industry?'])}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Food Industry Links</div>
                            <div class="info-value">${formatValue(app['If you have worked in the food industry, share with us actual links to social media posts.'])}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Remote Work Experience</div>
                            <div class="info-value">${formatValue(app['Have you worked remotely before?'])}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Currently Working</div>
                            <div class="info-value">${formatValue(app['Are you currently working?'])}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Current Work Hours</div>
                            <div class="info-value">${formatValue(app['If the answer is that you are currently working, how many hours do you currently work per day?'])}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">AI Usage</div>
                            <div class="info-value">${formatValue(app['Do you use AI at work, and if so, what models do you use?'])}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Expected Salary</div>
                            <div class="info-value">${formatValue(app['What salary do you expect?'])}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">4 Hours/Day Availability</div>
                            <div class="info-value">${formatValue(app['Are you ready to work 4 hours a day, 5 days a week?'])}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Previous Experience</div>
                            <div class="info-value">${formatValue(app['Previous experience'])}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Design Test Willingness</div>
                            <div class="info-value">${formatValue(app['Are you willing to send you links to social media and the website, and then you can create a design that suits our visual identity (knowing that it will be for testing only and will not be used for any commercial purposes and will not be published)?'])}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Preferred Work Days</div>
                            <div class="info-value">${formatValue(app['Which 5 days of the week do you prefer to work in?'])}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Preferred Work Times</div>
                            <div class="info-value">${formatValue(app['What are the times you prefer to work the 4 hours a day?'])}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Start Date</div>
                            <div class="info-value">${formatValue(app['What day will you be ready to start working?'])}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Notes</div>
                            <div class="info-value">${formatValue(app['Nots'])}</div>
                        </div>
                    </div>
                    
                    <div class="card-actions" onclick="event.stopPropagation();">
                        <button class="action-btn btn-not-open" onclick="updateStatus('${app.code}', 'not open')">
                            <i class="fas fa-envelope"></i> Not Open
                        </button>
                        <button class="action-btn btn-rejected" onclick="updateStatus('${app.code}', 'rejected')">
                            <i class="fas fa-times"></i> Rejected
                        </button>
                        <button class="action-btn btn-approved" onclick="updateStatus('${app.code}', 'approved')">
                            <i class="fas fa-check"></i> Approved
                        </button>
                        <button class="action-btn btn-special" onclick="updateStatus('${app.code}', 'special')">
                            <i class="fas fa-star"></i> Special
                        </button>
                        
                        ${app['WhatsApp number'] ? 
                            `<button class="action-btn btn-whatsapp" onclick="sendWhatsApp('${app['WhatsApp number']}')">
                                <i class="fab fa-whatsapp"></i> Send WhatsApp Message
                            </button>` : ''
                        }
                    </div>
                </div>
            `).join('');

            if (currentPage === 0) {
                grid.innerHTML = pageHTML;
            } else {
                grid.innerHTML += pageHTML;
            }
            
            // Check if all applications are loaded
            if (endIndex >= filteredApplications.length) {
                allApplicationsLoaded = true;
            }
        }

        function filterApplications() {
            console.log("[v0] Filtering applications for tab:", currentTab, "search:", searchTerm);
            
            filteredApplications = applications.filter(app => {
                const matchesTab = currentTab === 'all' || app.status === currentTab;
                const matchesSearch = !searchTerm || 
                    (app['Full Name'] && app['Full Name'].toLowerCase().includes(searchTerm.toLowerCase())) ||
                    (app['Email'] && app['Email'].toLowerCase().includes(searchTerm.toLowerCase())) ||
                    (app['WhatsApp number'] && app['WhatsApp number'].includes(searchTerm));
                
                return matchesTab && matchesSearch;
            });
            
            console.log("[v0] Filtered to", filteredApplications.length, "applications");
            
            currentPage = 0;
            allApplicationsLoaded = false;
            renderApplicationsPaginated();
        }

        function sendWhatsApp(phoneNumber) {
            let cleanNumber = phoneNumber.replace(/[^\d+]/g, '');
            
            // Add Egypt country code if not present
            if (!cleanNumber.startsWith('+') && !cleanNumber.startsWith('20')) {
                cleanNumber = '+20' + cleanNumber;
            } else if (cleanNumber.startsWith('0')) {
                cleanNumber = '+20' + cleanNumber.substring(1);
            } else if (!cleanNumber.startsWith('+')) {
                cleanNumber = '+' + cleanNumber;
            }
            
            const encodedMessage = encodeURIComponent(WHATSAPP_MESSAGE);
            const whatsappUrl = `https://wa.me/${cleanNumber}?text=${encodedMessage}`;
            window.open(whatsappUrl, '_blank');
        }

        // Open portfolio in modal
        function openPortfolio(url, name) {
            event.stopPropagation(); // Prevent card collapse
            const modal = document.getElementById('portfolioModal');
            const iframe = document.getElementById('modalIframe');
            const title = document.getElementById('modalTitle');
            
            // Ensure URL has proper protocol
            let portfolioUrl = url;
            if (!portfolioUrl.startsWith('http://') && !portfolioUrl.startsWith('https://')) {
                portfolioUrl = 'https://' + portfolioUrl;
            }
            
            title.textContent = `${name}'s Portfolio`;
            iframe.src = portfolioUrl;
            modal.style.display = 'block';
            
            // Add error handling for iframe loading
            iframe.onload = function() {
                console.log('[v0] Portfolio loaded successfully');
            };
            
            iframe.onerror = function() {
                console.log('[v0] Error loading portfolio, opening in new tab');
                window.open(portfolioUrl, '_blank');
                closeModal();
            };
        }

        // Close modal
        function closeModal() {
            const modal = document.getElementById('portfolioModal');
            const iframe = document.getElementById('modalIframe');
            modal.style.display = 'none';
            iframe.src = '';
        }

        function switchTab(tab) {
            currentTab = tab;
            
            // Update active tab styling
            document.querySelectorAll('.tab').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-status="${tab}"]`).classList.add('active');
            
            currentPage = 0;
            allApplicationsLoaded = false;
            filterApplications();
        }

        function searchApplications() {
            searchTerm = document.getElementById('searchInput').value;
            currentPage = 0;
            allApplicationsLoaded = false;
            filterApplications();
        }

        // Tab functionality
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                currentTab = tab.dataset.status;
                filterApplications();
            });
        });

        // Search functionality
        document.getElementById('searchInput').addEventListener('input', searchApplications);

        // Close modal when clicking outside
        window.addEventListener('click', (event) => {
            const modal = document.getElementById('portfolioModal');
            if (event.target === modal) {
                closeModal();
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            console.log("[v0] DOM loaded, initializing application...");
            
            // Set the default active tab
            document.querySelector('[data-status="not-open"]').classList.add('active');
            currentTab = 'not-open';
            
            // Load applications
            loadApplications();
        });

        function showError(message) {
            const loadingElement = document.getElementById('loading');
            if (loadingElement) {
                loadingElement.innerHTML = `
                    <div style="text-align: center; color: #d32f2f; max-width: 700px; margin: 0 auto;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 20px;"></i> 
                        <h3>Error</h3>
                        <p>${message}</p>
                        <button onclick="loadApplications()" style="margin-top: 20px; padding: 10px 20px; background: #8B4513; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            Try Again
                        </button>
                    </div>
                `;
            }
        }

        function formatValue(value) {
            return value ? value : 'Not provided';
        }

        function toggleCard(cardElement, appCode) {
            if (!cardElement || !appCode) return;
            
            const cardInfo = cardElement.querySelector('.card-info');
            const expandIcon = cardElement.querySelector('.expand-icon');
            
            if (!cardInfo || !expandIcon) return;
            
            const isExpanded = cardElement.classList.contains('expanded');
            
            if (isExpanded) {
                cardElement.classList.remove('expanded');
                cardInfo.style.display = 'none';
                expandIcon.classList.remove('fa-chevron-up');
                expandIcon.classList.add('fa-chevron-down');
            } else {
                cardElement.classList.add('expanded');
                cardInfo.style.display = 'block';
                expandIcon.classList.remove('fa-chevron-down');
                expandIcon.classList.add('fa-chevron-up');
                
                // Update status to opened if it's the first time
                const app = applications.find(a => a.code === appCode);
                if (app && app.status === 'not open') {
                    app.status = 'opened';
                    saveStatusToStorage(appCode, 'opened');
                    updateStats();
                }
            }
        }

        function updateStatus(code, newStatus) {
            event.stopPropagation(); // Prevent card collapse
            
            // Find and update the application
            const appIndex = applications.findIndex(app => app.code === code);
            if (appIndex !== -1) {
                applications[appIndex].status = newStatus;
                
                // Save to localStorage
                saveStatusToStorage(code, newStatus);
                
                // Update stats and re-render
                updateStats();
                currentPage = 0;
                allApplicationsLoaded = false;
                filterApplications();
            }
        }
    </script>

    <div id="loadingMore" style="display: none; text-align: center; padding: 20px;">
        <div class="loading-spinner"></div>
        <p>Loading more applications...</p>
    </div>
</body>
</html>
